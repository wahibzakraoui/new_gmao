!function(n){"use strict";var t,o,e,r,i=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=function(n){return function(){return n}},c=u(!1),a=u(!0),s=function(){return l},l=(t=function(n){return n.isNone()},{fold:function(n,t){return n()},is:c,isSome:c,isNone:a,getOr:e=function(n){return n},getOrThunk:o=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:u(null),getOrUndefined:u(void 0),or:e,orThunk:o,map:s,each:function(){},bind:s,exists:c,forall:a,filter:s,equals:t,equals_:t,toArray:function(){return[]},toString:u("none()")}),f=function(n){return function(t){return typeof t===n}},d=("string",function(n){return o=typeof(t=n),"string"===(null===t?"null":"object"==o&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==o&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":o);var t,o}),m=f("boolean"),v=f("number"),g=function(n,t){for(var o=0,e=n.length;o<e;o++)t(n[o],o)},h=Object.keys,p=function(n,t){for(var o=h(n),e=0,r=o.length;e<r;e++){var i=o[e];t(n[i],i)}},y=(void 0!==n.window?n.window:Function("return this;")(),function(n){return n.dom().nodeValue}),b=(3,function(n){return 3===n.dom().nodeType}),w=function(t,o,e){!function(t,o,e){if(!(d(e)||m(e)||v(e)))throw n.console.error("Invalid call to Attr.set. Key ",o,":: Value ",e,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(o,e+"")}(t.dom(),o,e)},k=function(n,t){n.dom().removeAttribute(t)},A=function(n,t){var o,e,r=(o=t,null===(e=n.dom().getAttribute(o))?void 0:e);return void 0===r||""===r?[]:r.split(" ")},C=function(n){return void 0!==n.dom().classList},N=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:u(n)}},O=N,T={" ":"nbsp","­":"shy"},S=function(n,t){var o="";return p(n,(function(n,t){o+=t})),new RegExp("["+o+"]",t?"g":"")},V=S(T),B=S(T,!0),E=(r="",p(T,(function(n){r&&(r+=","),r+="span.mce-"+n})),r),L="mce-nbsp",j=function(n){return'<span data-mce-bogus="1" class="mce-'+T[n]+'">'+n+"</span>"},x=function(n){var t=y(n);return b(n)&&void 0!==t&&V.test(t)},P=function(n,t){var o=[],e=function(n,t){for(var o=n.length,e=new Array(o),r=0;r<o;r++){var i=n[r];e[r]=t(i,r)}return e}(n.dom().childNodes,O);return g(e,(function(n){t(n)&&(o=o.concat([n])),o=o.concat(P(n,t))})),o},_=function(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")},D=function(n,t){var o=P(O(t),x);g(o,(function(t){var o,e,r=t.dom().parentNode;if(_(r))o=O(r),e=L,C(o)?o.dom().classList.add(e):function(n,t){return e=t,r=A(o=n,"class").concat([e]),w(o,"class",r.join(" ")),!0;var o,e,r}(o,e);else{for(var i=n.dom.encode(y(t)).replace(B,j),u=n.dom.create("div",null,i),c=void 0;c=u.lastChild;)n.dom.insertAfter(c,t.dom());n.dom.remove(t.dom())}}))},q=function(n,t){var o=n.dom.select(E,t);g(o,(function(t){_(t)?function(n,t){C(n)?n.dom().classList.remove(t):function(n,t){return r=t,0<(i=function(n,t){for(var o=[],e=0,r=n.length;e<r;e++){var i=n[e];t(i)&&o.push(i)}return o}(A(o=n,e="class"),(function(n){return n!==r}))).length?w(o,e,i.join(" ")):k(o,e),!1;var o,e,r,i}(n,t),function(n){0===(C(n)?n.dom().classList:A(n,"class")).length&&k(n,"class")}(n)}(O(t),L):n.dom.remove(t,!0)}))},I=function(n){var t=n.getBody(),o=n.selection.getBookmark(),e=function(n,t){for(;n.parentNode;){if(n.parentNode===t)return n;n=n.parentNode}}(n.selection.getNode(),t);q(n,e=void 0!==e?e:t),D(n,e),n.selection.moveToBookmark(o)},M=function(n,t){var o,e,r=n.getBody(),i=n.selection;t.set(!t.get()),o=n,e=t.get(),o.fire("VisualChars",{state:e});var u=i.getBookmark();(!0===t.get()?D:q)(n,r),i.moveToBookmark(u)},F=tinymce.util.Tools.resolve("tinymce.util.Delay"),K=function(n,t){return function(o){o.setActive(t.get());var e=function(n){return o.setActive(n.state)};return n.on("VisualChars",e),function(){return n.off("VisualChars",e)}}};i.add("visualchars",(function(n){var t,o,e,r,i,u,c,a,s,l,f,d=(t=!1,{get:function(){return t},set:function(n){t=n}});return e=d,(o=n).addCommand("mceVisualChars",(function(){M(o,e)})),i=d,(r=n).ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:function(){return r.execCommand("mceVisualChars")},onSetup:K(r,i)}),r.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:function(){return r.execCommand("mceVisualChars")},onSetup:K(r,i)}),u=n,c=d,a=F.debounce((function(){I(u)}),300),!1!==u.getParam("forced_root_block")&&u.on("keydown",(function(n){!0===c.get()&&(13===n.keyCode?I(u):a())})),l=d,(s=n).on("init",(function(){var n=!s.getParam("visualchars_default_state",!1);l.set(n),M(s,l)})),f=d,{isEnabled:function(){return f.get()}}}))}(window);