!function(t){"use strict";var n,e,r,o,i=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=tinymce.util.Tools.resolve("tinymce.util.VK"),a=function(t){return function(n){return r=typeof(e=n),(null===e?"null":"object"==r&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":r)===t;var e,r}},l=function(t){return function(n){return typeof n===t}},c=a("string"),f=a("array"),s=function(t){return n===t},m=l("boolean"),g=l("function"),d=function(t){var n=t.getParam("link_assume_external_targets",!1);return m(n)&&n?1:!c(n)||"http"!==n&&"https"!==n?0:n},h=function(t){return t.getParam("default_link_target")},v=function(t){return t.getParam("target_list",!0)},p=function(t){return t.getParam("rel_list",[],"array")},y=function(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")},k=function(){},x=function(t){return function(){return t}},b=x(!1),O=x(!(n=null)),w=function(){return C},C=(e=function(t){return t.isNone()},{fold:function(t,n){return t()},is:b,isSome:b,isNone:O,getOr:o=function(t){return t},getOrThunk:r=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:x(null),getOrUndefined:x(void 0),or:o,orThunk:r,map:w,each:k,bind:w,exists:b,forall:O,filter:w,equals:e,equals_:e,toArray:function(){return[]},toString:x("none()")}),A=function(t){var n=x(t),e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:O,isNone:b,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return A(n(t))},each:function(n){n(t)},bind:r,exists:r,forall:r,filter:function(n){return n(t)?o:C},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(b,(function(n){return e(t,n)}))}};return o},N={some:A,none:w,from:function(t){return null==t?C:A(t)}},P=Array.prototype.indexOf,_=Array.prototype.push,S=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!f(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);_.apply(n,t[e])}return n},T=function(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return N.none()},D=function(t,n){return t?N.some(n):N.none()},M=tinymce.util.Tools.resolve("tinymce.util.Tools"),L=function(t){return c(t.value)?t.value:""},E=function(t){return void 0===t&&(t=L),function(n){return N.from(n).map((function(n){return e=n,r=t,o=[],M.each(e,(function(t){var n=c(t.text)?t.text:c(t.title)?t.title:"";if(void 0===t.menu){var e=r(t);o.push({text:n,value:e})}})),o;var e,r,o}))}},R=function(t){return E(L)(t)},q=E,K=function(t,n){return function(e){return{name:t,type:"selectbox",label:n,items:e}}},I=L,U=function(){return(U=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},j=Object.keys,B=function(t,n){var e,r={};return function(t,n,e,r){(function(t,n){for(var e=j(t),r=0,o=e.length;r<o;r++){var i=e[r];n(t[i],i)}})(t,(function(t,o){(n(t,o)?e:r)(t,o)}))}(t,n,(e=r,function(t,n){e[n]=t}),k),r},F=function(t){return!(!/(^|[ ,])rtc([, ]|$)/.test(t.getParam("plugins","","string"))||!i.get("rtc"))},V=function(t){return/^\w+:/i.test(t)},$=function(t){return t.getAttribute("data-mce-href")||t.getAttribute("href")},H=function(t,n){var e,r,o=["noopener"],i=t?t.split(/\s+/):[],u=function(t){return t.filter((function(t){return-1===M.inArray(o,t)}))},a=n?0<(e=u(e=i)).length?e.concat(o):o:u(i);return 0<a.length?(r=a,M.trim(r.sort().join(" "))):""},z=function(t,n){return n=n||t.selection.getNode(),W(n)?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")},G=function(t,n){return(n?n.innerText||n.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")},J=function(t){return t&&"A"===t.nodeName&&!!$(t)},X=function(t){return 0<M.grep(t,J).length},Q=function(t){return!(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))},W=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},Y=function(t,n,e){var r=t.selection.getNode(),o=z(t,r),i=function(t,n){var e,r,o=U({},n);if(!(0<p(t).length)&&!1===y(t)){var i=H(o.rel,"_blank"===o.target);o.rel=i||null}return N.from(o.target).isNone()&&!1===v(t)&&(o.target=h(t)),o.href=(e=o.href,"http"!==(r=d(t))&&"https"!==r||V(e)?e:r+"://"+e),o}(t,function(t){return n=["title","rel","class","target"],e=function(n,e){return t[e].each((function(t){n[e]=0<t.length?t:null})),n},r={href:t.href},function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e])}(n,(function(t){r=e(r,t)})),r;var n,e,r}(e));t.undoManager.transact((function(){var u,a,l,c,f,s,m,g;e.href===n.href&&n.attach(),o?(t.focus(),f=t,s=o,m=e.text,g=i,m.each((function(t){s.hasOwnProperty("innerText")?s.innerText=t:s.textContent=t})),f.dom.setAttribs(s,g),f.selection.select(s)):(u=t,a=r,l=e.text,c=i,W(a)?et(u,a,c):l.fold((function(){u.execCommand("mceInsertLink",!1,c)}),(function(t){u.insertContent(u.dom.createHTML("a",c,u.dom.encode(t)))})))}))},Z=function(t,n,e){var r,o,i,u,a,l,c;F(t)?t.execCommand("createlink",!1,(o=(r=e).class,i=r.href,u=r.rel,a=r.target,l=r.text,c=r.title,B({class:o.getOrNull(),href:i,rel:u.getOrNull(),target:a.getOrNull(),text:l.getOrNull(),title:c.getOrNull()},(function(t,n){return!1===s(t)})))):Y(t,n,e)},tt=function(t){var n;F(t)?t.execCommand("unlink"):(n=t).undoManager.transact((function(){var t=n.selection.getNode();if(W(t))nt(n,t);else{var e=n.dom.getParent(t,"a[href]",n.getBody());e&&n.dom.remove(e,!0)}n.focus()}))},nt=function(t,n){var e=t.dom.select("img",n)[0];if(e){var r=t.dom.getParents(e,"a[href]",n)[0];r&&(r.parentNode.insertBefore(e,r),t.dom.remove(r))}},et=function(t,n,e){var r=t.dom.select("img",n)[0];if(r){var o=t.dom.create("a",e);r.parentNode.insertBefore(o,r),o.appendChild(r)}},rt=function(t,n){var e={text:t.text,title:t.title},r=function(t,r){var o,i,u=(o=n,("link"===(i=r.name)?o.link:"anchor"===i?o.anchor:N.none()).getOr([]));return function(t,n,e,r){var o,i=r[n],u=0<t.length;return void 0!==i?(o=i,T(e,(function(t){return D(t.value===o,t)})).map((function(n){return{url:{value:n.value,meta:{text:u?t:n.text,attach:k}},text:u?t:n.text}}))):N.none()}(e.text,r.name,u,t)};return{onChange:function(t,n){var o=n.name;return"url"===o?function(t){var n,r,o=(n=t.url,D(e.text.length<=0,N.from(n.meta.text).getOr(n.value))),i=(r=t.url,D(e.title.length<=0,N.from(r.meta.title).getOr("")));return o.isSome()||i.isSome()?N.some(U(U({},o.map((function(t){return{text:t}})).getOr({})),i.map((function(t){return{title:t}})).getOr({}))):N.none()}(t()):function(t,n){return e=t,r=n,-1<P.call(e,r);var e,r}(["anchor","link"],o)?r(t(),n):(("text"===o||"title"===o)&&(e[o]=t()[o]),N.none())}}},ot=tinymce.util.Tools.resolve("tinymce.util.Delay"),it=tinymce.util.Tools.resolve("tinymce.util.Promise"),ut=function(t){var n=t.href;return 0<n.indexOf("@")&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:")?N.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return U(U({},t),{href:"mailto:"+n})}}):N.none()},at=function(t,n){return T([ut,(e=d(t),r=t.getParam("link_default_protocol","http","string"),function(t){var n=t.href;return 1===e&&!V(n)||0===e&&/^\s*www[\.|\d\.]/i.test(n)?N.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+r+":// prefix?",preprocess:function(t){return U(U({},t),{href:r+"://"+n})}}):N.none()})],(function(t){return t(n)})).fold((function(){return it.resolve(n)}),(function(e){return new it((function(r){var o,i,u,a;o=t,i=e.message,u=function(t){r(t?e.preprocess(n):n)},a=o.selection.getRng(),ot.setEditorTimeout(o,(function(){o.windowManager.confirm(i,(function(t){o.selection.setRng(a),u(t)}))}))}))}));var e,r},lt=function(t){var n=function(t,n){return S(function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r}(t,n))}(t.dom.select("a:not([href])"),(function(t){var n=t.name||t.id;return n?[{text:n,value:"#"+n}]:[]}));return 0<n.length?N.some([{text:"None",value:""}].concat(n)):N.none()},ct=function(t){var n=t.getParam("link_class_list",[],"array");return 0<n.length?R(n):N.none()},ft=tinymce.util.Tools.resolve("tinymce.util.XHR"),st=function(t,n){var e=p(t);if(0<e.length){var r=n.is("_blank");return(!1===y(t)?q((function(t){return H(I(t),r)})):R)(e)}return N.none()},mt=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],gt=function(t){var n=v(t);return f(n)?R(n).orThunk((function(){return N.some(mt)})):!1===n?N.none():N.some(mt)},dt=function(t,n,e){var r=t.getAttrib(n,e);return null!==r&&0<r.length?N.some(r):N.none()},ht=function(t,n){return function(t){var n=function(n){return t.convertURL(n.value||n.url,"href")},e=t.getParam("link_list");return new it((function(t){c(e)?ft.send({url:e,success:function(n){return t(function(t){try{return N.some(JSON.parse(t))}catch(t){return N.none()}}(n))},error:function(n){return t(N.none())}}):g(e)?e((function(n){return t(N.some(n))})):t(N.from(e))})).then((function(t){return t.bind(q(n)).map((function(t){return 0<t.length?[{text:"None",value:""}].concat(t):t}))}))}(t).then((function(e){var r,o,i,u,a,l,c,f,s=(o=n,i=(r=t).dom,u=Q(r.selection.getContent())?N.some(G(r.selection,o)):N.none(),a=o?N.some(i.getAttrib(o,"href")):N.none(),l=o?N.from(i.getAttrib(o,"target")):N.none(),c=dt(i,o,"rel"),f=dt(i,o,"class"),{url:a,text:u,title:dt(i,o,"title"),target:l,rel:c,linkClass:f});return{anchor:s,catalogs:{targets:gt(t),rels:st(t,s.target),classes:ct(t),anchor:lt(t),link:e},optNode:N.from(n),flags:{titleEnabled:t.getParam("link_title",!0,"boolean")}}}))},vt=function(t,n){return t.dom.getParent(n,"a[href]")},pt=function(t){return vt(t,t.selection.getStart())},yt=function(n,e){if(e){var r=$(e);if(/^#/.test(r)){var o=n.$(r);o.length&&n.selection.scrollIntoView(o[0],!0)}else!function(n){var e=t.document.createElement("a");e.target="_blank",e.href=n,e.rel="noreferrer noopener";var r,o,i=t.document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,t.window,0,0,0,0,0,!1,!1,!1,!1,0,null),r=e,o=i,t.document.body.appendChild(r),r.dispatchEvent(o),t.document.body.removeChild(r)}(e.href)}},kt=function(t){return function(){!function(t){var n,e;(e=z(n=t),ht(n,e)).then((function(n){var e,r,o,i,u,a,l,c,f,s,m,g,d;return i=function(t){var n=t.getData();if(!n.url.value)return tt(e),void t.close();var o=function(t){return N.from(n[t]).filter((function(n){return!r.anchor[t].is(n)}))},i={href:n.url.value,text:o("text"),target:o("target"),rel:o("rel"),class:o("linkClass"),title:o("title")},u={href:n.url.value,attach:void 0!==n.url.meta&&n.url.meta.attach?n.url.meta.attach:function(){}};at(e,i).then((function(t){Z(e,u,t)})),t.close()},u=e=t,f=(o=r=n).anchor.text.map((function(){return{name:"text",type:"input",label:"Text to display"}})).toArray(),s=o.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],a=N.from(h(u)),m={url:{value:c=(l=o.anchor).url.getOr(""),meta:{original:{value:c}}},text:l.text.getOr(""),title:l.title.getOr(""),anchor:c,link:c,rel:l.rel.getOr(""),target:l.target.or(a).getOr(""),linkClass:l.linkClass.getOr("")},g=o.catalogs,d=rt(m,g),{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:S([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],f,s,function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n}([g.anchor.map(K("anchor","Anchors")),g.rels.map(K("rel","Rel")),g.targets.map(K("target","Open link in...")),g.link.map(K("link","Link list")),g.classes.map(K("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:m,onChange:function(t,n){var e=n.name;d.onChange(t.getData,{name:e}).each((function(n){t.setData(n)}))},onSubmit:i}})).then((function(n){t.windowManager.open(n)}))}(t)}},xt=function(t){return function(){yt(t,pt(t))}},bt=function(t){t.on("click",(function(n){var e=vt(t,n.target);e&&u.metaKeyPressed(n)&&(n.preventDefault(),yt(t,e))})),t.on("keydown",(function(n){var e,r=pt(t);r&&13===n.keyCode&&!0===(e=n).altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey&&(n.preventDefault(),yt(t,r))}))},Ot=function(t){return function(n){var e=function(e){return n.setActive(!t.mode.isReadOnly()&&!!z(t,e.element))};return t.on("NodeChange",e),function(){return t.off("NodeChange",e)}}},wt=function(t){return function(n){var e=t.dom.getParents(t.selection.getStart());n.setDisabled(!X(e));var r=function(t){return n.setDisabled(!X(t.parents))};return t.on("NodeChange",r),function(){return t.off("NodeChange",r)}}};i.add("link",(function(t){var n,e,r,o,i,u,a;(n=t).ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:kt(n),onSetup:Ot(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:xt(n),onSetup:wt(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return tt(n)},onSetup:wt(n)}),(e=t).ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:xt(e),onSetup:wt(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:kt(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return tt(e)},onSetup:wt(e)}),(r=t).ui.registry.addContextMenu("link",{update:function(t){return X(r.dom.getParents(t,"a"))?"link unlink openlink":"link"}}),i=function(t){var n=o.selection.getNode();return t.setDisabled(!z(o,n)),function(){}},(o=t).ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:Ot(o)},label:"Link",predicate:function(t){return!!z(o,t)&&o.getParam("link_context_toolbar",!1,"boolean")},initValue:function(){var t=z(o);return t?$(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var n=o.selection.getNode();return t.setActive(!!z(o,n)),Ot(o)(t)},onAction:function(t){var n=z(o),e=t.getValue();if(n)o.undoManager.transact((function(){o.dom.setAttrib(n,"href",e),o.selection.collapse(!1),t.hide()}));else{var r={href:e,attach:function(){}},i=Q(o.selection.getContent())?N.some(G(o.selection,n)).filter((function(t){return 0<t.length})).or(N.from(e)):N.none();Z(o,r,{href:e,text:i,title:N.none(),rel:N.none(),target:N.none(),class:N.none()}),t.hide()}}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:i,onAction:function(t){tt(o),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:i,onAction:function(t){xt(o)(),t.hide()}}]}),bt(t),(u=t).addCommand("mceLink",(function(){u.getParam("link_quicklink",!1,"boolean")?u.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):kt(u)()})),(a=t).addShortcut("Meta+K","",(function(){a.execCommand("mceLink")}))}))}(window);