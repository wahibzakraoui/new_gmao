!function(e){"use strict";var t,n,r,o,i,a,u=tinymce.util.Tools.resolve("tinymce.PluginManager"),s=function(){},c=function(e){return function(){return e}},f=function(e){return function(t){return!e(t)}},d=c(!1),l=c(!0),m=function(){return p},p=(t=function(e){return e.isNone()},{fold:function(e,t){return e()},is:d,isSome:d,isNone:l,getOr:r=function(e){return e},getOrThunk:n=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:c(null),getOrUndefined:c(void 0),or:r,orThunk:n,map:m,each:s,bind:m,exists:d,forall:l,filter:m,equals:t,equals_:t,toArray:function(){return[]},toString:c("none()")}),g=function(e){var t=c(e),n=function(){return o},r=function(t){return t(e)},o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:l,isNone:d,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return g(t(e))},each:function(t){t(e)},bind:r,exists:r,forall:r,filter:function(t){return t(e)?o:p},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(d,(function(t){return n(e,t)}))}};return o},v={some:g,none:m,from:function(e){return null==e?p:g(e)}},h=function(e){return function(t){return r=typeof(n=t),(null===n?"null":"object"==r&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":r)===e;var n,r}},y=function(e){return function(t){return typeof t===e}},S=h("string"),b=h("array"),C=y("boolean"),O=y("function"),N=y("number"),L=Array.prototype.slice,T=Array.prototype.push,k=function(e,t){for(var n=e.length,r=new Array(n),o=0;o<n;o++){var i=e[o];r[o]=t(i,o)}return r},w=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)},x=function(e,t){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];t(i,r)&&n.push(i)}return n},A=function(e,t,n){return w(e,(function(e){n=t(n,e)})),n},D=function(e,t,n){for(var r=0,o=e.length;r<o;r++){var i=e[r];if(t(i,r))return v.some(i);if(n(i,r))break}return v.none()},E=function(e,t){return D(e,t,d)},B=function(e,t){return function(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!b(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);T.apply(t,e[n])}return t}(k(e,t))},R=function(e){var t=L.call(e,0);return t.reverse(),t},I=function(e){return 0===e.length?v.none():v.some(e[0])},P=function(e){return 0===e.length?v.none():v.some(e[e.length-1])},M=function(){return(M=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},U=function(){return _(0,0)},_=function(e,t){return{major:e,minor:t}},F=function(e,t){var n=String(t).toLowerCase();return 0===e.length?U():function(e,t){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.test(t))return r}}(e,t);if(!n)return{major:0,minor:0};var r=function(e){return Number(t.replace(n,"$"+e))};return _(r(1),r(2))}(e,n)},$=U,j="Edge",q="Chrome",H="Opera",K="Firefox",V="Safari",W=function(e){var t=e.current,n=e.version,r=function(e){return function(){return t===e}};return{current:t,version:n,isEdge:r(j),isChrome:r(q),isIE:r("IE"),isOpera:r(H),isFirefox:r(K),isSafari:r(V)}},Q=function(){return W({current:void 0,version:$()})},X=W,z=(c(j),c(q),c("IE"),c(H),c(K),c(V),"Windows"),Y="Android",G="Solaris",J="FreeBSD",Z="ChromeOS",ee=function(e){var t=e.current,n=e.version,r=function(e){return function(){return t===e}};return{current:t,version:n,isWindows:r(z),isiOS:r("iOS"),isAndroid:r(Y),isOSX:r("OSX"),isLinux:r("Linux"),isSolaris:r(G),isFreeBSD:r(J),isChromeOS:r(Z)}},te=function(){return ee({current:void 0,version:$()})},ne=ee,re=(c(z),c("iOS"),c(Y),c("Linux"),c("OSX"),c(G),c(J),c(Z),function(e,t){var n=String(t).toLowerCase();return E(e,(function(e){return e.search(n)}))}),oe=function(e,t){return-1!==e.indexOf(t)},ie=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,ae=function(e){return function(t){return oe(t,e)}},ue=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return oe(e,"edge/")&&oe(e,"chrome")&&oe(e,"safari")&&oe(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,ie],search:function(e){return oe(e,"chrome")&&!oe(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return oe(e,"msie")||oe(e,"trident")}},{name:"Opera",versionRegexes:[ie,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:ae("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:ae("firefox")},{name:"Safari",versionRegexes:[ie,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(oe(e,"safari")||oe(e,"mobile/"))&&oe(e,"applewebkit")}}],se=[{name:"Windows",search:ae("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return oe(e,"iphone")||oe(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:ae("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:ae("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:ae("linux"),versionRegexes:[]},{name:"Solaris",search:ae("sunos"),versionRegexes:[]},{name:"FreeBSD",search:ae("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:ae("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],ce={browsers:c(ue),oses:c(se)},fe=function(e,t){var n,r,o,i,a,u,s,f,d,l,m,p,g=ce.browsers(),v=ce.oses(),h=function(e,t){return re(e,t).map((function(e){var n=F(e.versionRegexes,t);return{current:e.name,version:n}}))}(g,e).fold(Q,X),y=function(e,t){return re(e,t).map((function(e){var n=F(e.versionRegexes,t);return{current:e.name,version:n}}))}(v,e).fold(te,ne);return{browser:h,os:y,deviceType:(r=h,o=e,i=t,a=(n=y).isiOS()&&!0===/ipad/i.test(o),u=n.isiOS()&&!a,s=n.isiOS()||n.isAndroid(),f=s||i("(pointer:coarse)"),d=a||!u&&s&&i("(min-device-width:768px)"),l=u||s&&!d,m=r.isSafari()&&n.isiOS()&&!1===/safari/i.test(o),p=!l&&!d&&!m,{isiPad:c(a),isiPhone:c(u),isTablet:c(d),isPhone:c(l),isTouch:c(f),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:c(m),isDesktop:c(p)})}},de=function(t){return e.window.matchMedia(t).matches},le=(a=!(o=function(){return fe(e.navigator.userAgent,de)}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a||(a=!0,i=o.apply(null,e)),i}),me=function(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:c(e)}},pe=function(t,n){var r=(n||e.document).createElement(t);return me(r)},ge=me,ve=function(e,t){return e.dom()===t.dom()},he=function(t,n){return le().browser.isIE()?function(t,n){return r=t.dom(),o=n.dom(),i=e.Node.DOCUMENT_POSITION_CONTAINED_BY,0!=(r.compareDocumentPosition(o)&i);var r,o,i}(t,n):(r=n,(o=t.dom())!==(i=r.dom())&&o.contains(i));var r,o,i},ye=function(e,t){var n=e.dom();if(1!==n.nodeType)return!1;var r=n;if(void 0!==r.matches)return r.matches(t);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(t);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(t);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},Se=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),be=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),Ce=tinymce.util.Tools.resolve("tinymce.util.VK"),Oe=function(e,t,n){return e.isSome()&&t.isSome()?v.some(n(e.getOrDie(),t.getOrDie())):v.none()},Ne=(void 0!==e.window?e.window:Function("return this;")(),function(e){return e.dom().nodeName.toLowerCase()}),Le=(1,function(e){return 1===e.dom().nodeType}),Te=function(e){return v.from(e.dom().parentNode).map(ge)},ke=function(e){return k(e.dom().childNodes,ge)},we=function(e,t){var n=e.dom().childNodes;return v.from(n[t]).map(ge)},xe=function(e){return we(e,0)},Ae=function(e){return we(e,e.dom().childNodes.length-1)},De=function(e,t){Te(e).each((function(n){n.dom().insertBefore(t.dom(),e.dom())}))},Ee=function(e,t){e.dom().appendChild(t.dom())},Be=function(e,t){w(t,(function(t){Ee(e,t)}))},Re=function(e){var t=e.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},Ie=function(e,t,n){return e.fire("ListMutation",{action:t,element:n})},Pe=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),Me=tinymce.util.Tools.resolve("tinymce.util.Tools"),Ue=function(e){return function(t){return t&&t.nodeName.toLowerCase()===e}},_e=function(e){return function(t){return t&&e.test(t.nodeName)}},Fe=function(e){return e&&3===e.nodeType},$e=_e(/^(OL|UL|DL)$/),je=_e(/^(OL|UL)$/),qe=Ue("ol"),He=_e(/^(LI|DT|DD)$/),Ke=_e(/^(DT|DD)$/),Ve=_e(/^(TH|TD)$/),We=Ue("br"),Qe=function(e,t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]},Xe=function(e,t){return e&&e.nodeName in t},ze=function(e,t,n){var r=e.isEmpty(t);return!(n&&0<e.select("span[data-mce-type=bookmark]",t).length)&&r},Ye=function(e,t){return e.isChildOf(t,e.getRoot())},Ge=function(e,t){var n=t||e.selection.getStart(!0);return e.dom.getParent(n,"OL,UL,DL",Ze(e,n))},Je=function(e){var t,n,r,o=e.selection.getSelectedBlocks();return Me.grep((t=e,n=o,r=Me.map(n,(function(e){return t.dom.getParent(e,"li,dd,dt",Ze(t,e))||e})),Pe.unique(r)),(function(e){return He(e)}))},Ze=function(e,t){var n=e.dom.getParents(t,"TD,TH");return 0<n.length?n[0]:e.getBody()},et=function(e,t){var n=e.dom.getParents(t,"ol,ul",Ze(e,t));return P(n)},tt=function(e,t){var n=k(t,(function(t){return et(e,t).getOr(t)}));return Pe.unique(n)},nt=function(e,t){var n,r,o,i,a=e.dom,u=e.schema.getBlockElements(),s=a.createFragment(),c=!1===(n=e.getParam("forced_root_block","p"))?"":!0===n?"p":n;if(c&&((o=a.create(c)).tagName===c.toUpperCase()&&a.setAttribs(o,e.getParam("forced_root_block_attrs",{})),Xe(t.firstChild,u)||s.appendChild(o)),t)for(;r=t.firstChild;){var f=r.nodeName;i||"SPAN"===f&&"bookmark"===r.getAttribute("data-mce-type")||(i=!0),Xe(r,u)?(s.appendChild(r),o=null):c?(o||(o=a.create(c),s.appendChild(o)),o.appendChild(r)):s.appendChild(r)}return c?i||o.appendChild(a.create("br",{"data-mce-bogus":"1"})):s.appendChild(a.create("br")),s},rt=Object.keys,ot=function(e,t){for(var n=rt(e),r=0,o=n.length;r<o;r++){var i=n[r];t(e[i],i)}},it=function(t,n){var r=t.dom();ot(n,(function(t,n){!function(t,n,r){if(!(S(r)||C(r)||N(r)))throw e.console.error("Invalid call to Attr.set. Key ",n,":: Value ",r,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(n,r+"")}(r,n,t)}))},at=function(e){return A(e.dom().attributes,(function(e,t){return e[t.name]=t.value,e}),{})},ut=(O(e.Element.prototype.attachShadow)&&O(e.Node.prototype.getRootNode),function(t,n,r){if(!S(r))throw e.console.error("Invalid call to CSS.set. Property ",n,":: Value ",r,":: Element ",t),new Error("CSS value must be a string: "+r);var o;void 0!==(o=t).style&&O(o.style.getPropertyValue)&&t.style.setProperty(n,r)}),st=function(e){return!0,ge(e.dom().cloneNode(true))},ct=function(e,t){var n,r,o,i=(n=e,r=pe(t),o=at(n),it(r,o),r);De(e,i);var a=ke(e);return Be(i,a),Re(e),i},ft=function(e,t){Ee(e.item,t.list)},dt=function(e,t,n){var r=t.slice(0,n.depth);return P(r).each((function(t){var r,o,i,a,u,s,c,f;s=(r=e,o=n.itemAttributes,i=n.content,a=pe("li",r),it(a,o),Be(a,i),a),Ee((u=t).list,s),u.item=s,f=n,Ne((c=t).list)!==f.listType&&(c.list=ct(c.list,f.listType)),it(c.list,f.listAttributes)})),r},lt=function(e,t,n){var r,o=function(e,t,n){for(var r,o,i,a=[],u=0;u<n;u++)a.push((r=e,o=t.listType,i={list:pe(o,r),item:pe("li",r)},Ee(i.list,i.item),i));return a}(e,n,n.depth-t.length);return function(e){for(var t=1;t<e.length;t++)ft(e[t-1],e[t])}(o),function(e,t){for(var n=0;n<e.length-1;n++)"list-style-type","none",r=e[n].item.dom(),ut(r,"list-style-type","none");var r;P(e).each((function(e){it(e.list,t.listAttributes),it(e.item,t.itemAttributes),Be(e.item,t.content)}))}(o,n),r=o,Oe(P(t),I(r),ft),t.concat(o)},mt=function(e){return ye(e,"OL,UL")},pt=function(e){return xe(e).map(mt).getOr(!1)},gt=function(e){return 0<e.depth},vt=function(e){return e.isSelected},ht=function(e){var t=ke(e),n=Ae(e).map(mt).getOr(!1)?t.slice(0,-1):t;return k(n,st)},yt=function(e){return w(e,(function(t,n){var r,o,i,a,u;i=(r=e)[o=n].depth,a=function(e){return e.depth===i&&!e.dirty},u=function(e){return e.depth<i},D(R(r.slice(0,o)),a,u).orThunk((function(){return D(r.slice(o+1),a,u)})).fold((function(){var e;t.dirty&&((e=t).listAttributes=function(e,t){var n,r,o,i,a={};return n=t,i=a,r=function(e,t){i[t]=e},o=s,ot(e,(function(e,t){(n(e,t)?r:o)(e,t)})),a}(e.listAttributes,(function(e,t){return"start"!==t})))}),(function(e){return r=e,(n=t).listType=r.listType,void(n.listAttributes=M({},r.listAttributes));var n,r}))})),e},St=function(e,t,n,r){return xe(r).filter(mt).fold((function(){t.each((function(e){ve(e.start,r)&&n.set(!0)}));var o,i,a,u=(o=r,i=e,a=n.get(),Te(o).filter(Le).map((function(e){return{depth:i,dirty:!1,isSelected:a,content:ht(o),itemAttributes:at(o),listAttributes:at(e),listType:Ne(e)}})));t.each((function(e){ve(e.end,r)&&n.set(!1)}));var s=Ae(r).filter(mt).map((function(r){return bt(e,t,n,r)})).getOr([]);return u.toArray().concat(s)}),(function(r){return bt(e,t,n,r)}))},bt=function(e,t,n,r){return B(ke(r),(function(r){return(mt(r)?bt:St)(e+1,t,n,r)}))},Ct=function(t,n){var r=yt(n);return k(r,(function(n){var r,o,i=(r=n.content,o=e.document.createDocumentFragment(),w(r,(function(e){o.appendChild(e.dom())})),ge(o));return ge(nt(t,i.dom()))}))},Ot=function(e,t){var n,r,o=yt(t);return n=e.contentDocument,r=A(o,(function(e,t){return(t.depth>e.length?lt:dt)(n,e,t)}),[]),I(r).map((function(e){return e.list})).toArray()},Nt=function(e,t,n){var r,o=function(e,t){var n,r=(n=!1,{get:function(){return n},set:function(e){n=e}});return k(e,(function(e){return{sourceList:e,entries:bt(0,t,r,e)}}))}(t,(r=k(Je(e),ge),Oe(E(r,f(pt)),E(R(r),f(pt)),(function(e,t){return{start:e,end:t}}))));w(o,(function(t){var r,o;r=t.entries,o=n,w(x(r,vt),(function(e){return function(e,t){switch(e){case"Indent":t.depth++;break;case"Outdent":t.depth--;break;case"Flatten":t.depth=0}t.dirty=!0}(o,e)}));var i,a,u,s=(i=e,a=t.entries,B(function(e,t){if(0===e.length)return[];for(var n=t(e[0]),r=[],o=[],i=0,a=e.length;i<a;i++){var u=e[i],s=t(u);s!==n&&(r.push(o),o=[]),n=s,o.push(u)}return 0!==o.length&&r.push(o),r}(a,gt),(function(e){return(I(e).map(gt).getOr(!1)?Ot:Ct)(i,e)})));w(s,(function(t){Ie(e,"Indent"===n?"IndentList":"OutdentList",t.dom())})),u=t.sourceList,w(s,(function(e){De(u,e)})),Re(t.sourceList)}))},Lt=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Tt=Lt.DOM,kt=function(e){ye(e,"dt")&&ct(e,"dd")},wt=function(e,t){if(Fe(e))return{container:e,offset:t};var n=Se.getNode(e,t);return Fe(n)?{container:n,offset:t>=e.childNodes.length?n.data.length:0}:n.previousSibling&&Fe(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&Fe(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:e,offset:t}},xt=function(e){var t=e.cloneRange(),n=wt(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);var r=wt(e.endContainer,e.endOffset);return t.setEnd(r.container,r.offset),t},At=function(e,t){var n,r=k(function(e){var t,n,r,o=(n=et(t=e,t.selection.getStart()),r=x(t.selection.getSelectedBlocks(),je),n.toArray().concat(r));return tt(e,o)}(e),ge),o=k(x(Je(e),Ke),ge),i=!1;if(r.length||o.length){var a=e.selection.getBookmark();Nt(e,r,t),n=e,w(o,"Indent"===t?kt:function(e){return function(e,t){ye(t,"dd")?ct(t,"dt"):ye(t,"dt")&&Te(t).each((function(n){return function(e,t,n){var r=Tt.select('span[data-mce-type="bookmark"]',t),o=nt(e,n),i=Tt.createRng();i.setStartAfter(n),i.setEndAfter(t);for(var a,u=i.extractContents(),s=u.firstChild;s;s=s.firstChild)if("LI"===s.nodeName&&e.dom.isEmpty(s)){Tt.remove(s);break}e.dom.isEmpty(u)||Tt.insertAfter(u,t),Tt.insertAfter(o,t),ze(e.dom,n.parentNode)&&(a=n.parentNode,Me.each(r,(function(e){a.parentNode.insertBefore(e,n.parentNode)})),Tt.remove(a)),Tt.remove(n),ze(e.dom,t)&&Tt.remove(t)}(e,n.dom(),t.dom())}))}(n,e)}),e.selection.moveToBookmark(a),e.selection.setRng(xt(e.selection.getRng())),e.nodeChanged(),i=!0}return i},Dt=function(e){return At(e,"Indent")},Et=function(e){return At(e,"Outdent")},Bt=function(e){return At(e,"Flatten")},Rt=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),It=Lt.DOM,Pt=function(e){var t={},n=function(n){var r,o,i;o=e[n?"startContainer":"endContainer"],i=e[n?"startOffset":"endOffset"],1===o.nodeType&&(r=It.create("span",{"data-mce-type":"bookmark"}),o.hasChildNodes()?(i=Math.min(i,o.childNodes.length-1),n?o.insertBefore(r,o.childNodes[i]):It.insertAfter(r,o.childNodes[i])):o.appendChild(r),o=r,i=0),t[n?"startContainer":"endContainer"]=o,t[n?"startOffset":"endOffset"]=i};return n(!0),e.collapsed||n(),t},Mt=function(e){function t(t){var n,r,o;n=o=e[t?"startContainer":"endContainer"],r=e[t?"startOffset":"endOffset"],n&&(1===n.nodeType&&(r=function(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t===e)return n;1===t.nodeType&&"bookmark"===t.getAttribute("data-mce-type")||n++,t=t.nextSibling}return-1}(n),n=n.parentNode,It.remove(o),!n.hasChildNodes()&&It.isBlock(n)&&n.appendChild(It.create("br"))),e[t?"startContainer":"endContainer"]=n,e[t?"startOffset":"endOffset"]=r)}t(!0),t();var n=It.createRng();return n.setStart(e.startContainer,e.startOffset),e.endContainer&&n.setEnd(e.endContainer,e.endOffset),xt(n)},Ut=function(e){switch(e){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},_t=function(e){return/\btox\-/.test(e.className)},Ft=function(e,t,n){var r=function(e){var r=D(e.parents,$e,Ve).filter((function(e){return e.nodeName===t&&!_t(e)})).isSome();n(r)},o=e.dom.getParents(e.selection.getNode());return r({parents:o}),e.on("NodeChange",r),function(){return e.off("NodeChange",r)}},$t=function(e,t){Me.each(t,(function(t,n){e.setAttribute(n,t)}))},jt=function(e,t,n){var r,o,i,a,u,s,c;r=e,o=t,a=(i=n)["list-style-type"]?i["list-style-type"]:null,r.setStyle(o,"list-style-type",a),u=e,$t(s=t,(c=n)["list-attributes"]),Me.each(u.select("li",s),(function(e){$t(e,c["list-item-attributes"])}))},qt=function(e,t,n,r){var o=t[n?"startContainer":"endContainer"],i=t[n?"startOffset":"endOffset"];for(1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!n&&We(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(Qe(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},Ht=function(e,t,n){return s=n,(u=t)&&s&&$e(u)&&u.nodeName===s.nodeName&&(i=t,a=n,(o=e).getStyle(i,"list-style-type",!0)===o.getStyle(a,"list-style-type",!0))&&(r=n,t.className===r.className);var r,o,i,a,u,s},Kt=function(e,t){var n,r;if(n=t.nextSibling,Ht(e,t,n)){for(;r=n.firstChild;)t.appendChild(r);e.remove(n)}if(n=t.previousSibling,Ht(e,t,n)){for(;r=n.lastChild;)t.insertBefore(r,t.firstChild);e.remove(n)}},Vt=function(e){return"list-style-type"in e},Wt=function(e,t,n){var r=Ge(e),o=function(e){var t,n,r,o=Ge(e),i=e.selection.getSelectedBlocks();return r=i,(n=o)&&1===r.length&&r[0]===n?(t=o,Me.grep(t.querySelectorAll("ol,ul,dl"),(function(e){return $e(e)}))):Me.grep(i,(function(e){return $e(e)&&o!==e}))}(e);n=n||{},r&&0<o.length?function(e,t,n,r,o){if(t.nodeName!==r||Vt(o)){var i=Pt(e.selection.getRng(!0));Me.each([t].concat(n),(function(t){!function(e,t,n,r){if(t.nodeName!==n){var o=e.dom.rename(t,n);jt(e.dom,o,r),Ie(e,Ut(n),o)}else jt(e.dom,t,r),Ie(e,Ut(n),t)}(e,t,r,o)})),e.selection.setRng(Mt(i))}else Bt(e)}(e,r,o,t,n):function(e,t,n,r){if(t!==e.getBody())if(t)if(t.nodeName!==n||Vt(r)||_t(t)){var o=Pt(e.selection.getRng(!0));jt(e.dom,t,r);var i=e.dom.rename(t,n);Kt(e.dom,i),e.selection.setRng(Mt(o)),Ie(e,Ut(n),i)}else Bt(e);else(function(e,t,n){void 0===n&&(n={});var r=e.selection.getRng(),o="LI",i=Ze(e,e.selection.getStart(!0)),a=e.dom;if("false"!==a.getContentEditable(e.selection.getNode())){"DL"===(t=t.toUpperCase())&&(o="DT");var u=Pt(r);Me.each(function(e,t,n){for(var r,o=[],i=e.dom,a=qt(e,t,!0,n),u=qt(e,t,!1,n),s=[],c=a;c&&(s.push(c),c!==u);c=c.nextSibling);return Me.each(s,(function(t){if(Qe(e,t))return o.push(t),void(r=null);if(i.isBlock(t)||We(t))return We(t)&&i.remove(t),void(r=null);var a=t.nextSibling;Rt.isBookmarkNode(t)&&(Qe(e,a)||!a&&t.parentNode===n)?r=null:(r||(r=i.create("p"),t.parentNode.insertBefore(r,t),o.push(r)),r.appendChild(t))})),o}(e,r,i),(function(r){var i,u,s,c,f,d,l,m=r.previousSibling;m&&$e(m)&&m.nodeName===t&&(u=m,s=n,a.getStyle(u,"list-style-type")===(c=null===(c=s?s["list-style-type"]:"")?"":c))?(i=m,r=a.rename(r,o),m.appendChild(r)):(i=a.create(t),r.parentNode.insertBefore(i,r),i.appendChild(r),r=a.rename(r,o)),f=a,d=r,l=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],Me.each(l,(function(e){var t;return f.setStyle(d,((t={})[e]="",t))})),jt(a,i,n),Kt(e.dom,i)})),e.selection.setRng(Mt(u))}})(e,n,r),Ie(e,Ut(n),t)}(e,r,t,n)},Qt=Lt.DOM,Xt=function(e,t,n,r){var o=t.startContainer,i=t.startOffset;if(Fe(o)&&(n?i<o.data.length:0<i))return o;var a=e.schema.getNonEmptyElements();1===o.nodeType&&(o=Se.getNode(o,i));var u,s,c=new be(o,r);for(n&&(u=e.dom,We(s=o)&&u.isBlock(s.nextSibling)&&!We(s.previousSibling)&&c.next());o=c[n?"next":"prev2"]();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(a[o.nodeName])return o;if(Fe(o)&&0<o.data.length)return o}},zt=function(e,t){var n=t.childNodes;return 1===n.length&&!$e(n[0])&&e.isBlock(n[0])},Yt=function(e,t,n){var r,o=t.parentNode;if(Ye(e,t)&&Ye(e,n)){$e(n.lastChild)&&(r=n.lastChild),o===n.lastChild&&We(o.previousSibling)&&e.remove(o.previousSibling);var i=n.lastChild;i&&We(i)&&t.hasChildNodes()&&e.remove(i),ze(e,n,!0)&&e.$(n).empty(),function(e,t,n){var r,o,i,a=zt(e,n)?n.firstChild:n;if(zt(o=e,i=t)&&o.remove(i.firstChild,!0),!ze(e,t,!0))for(;r=t.firstChild;)a.appendChild(r)}(e,t,n),r&&n.appendChild(r);var a=he(ge(n),ge(t))?e.getParents(t,$e,n):[];e.remove(t),w(a,(function(t){ze(e,t)&&t!==e.getRoot()&&e.remove(t)}))}},Gt=function(e,t){var n=e.dom,r=e.selection,o=r.getStart(),i=Ze(e,o),a=n.getParent(r.getStart(),"LI",i);if(a){var u=a.parentNode;if(u===e.getBody()&&ze(n,u))return!0;var s=xt(r.getRng()),c=n.getParent(Xt(e,s,t,i),"LI",i);if(c&&c!==a)return e.undoManager.transact((function(){var n;t?function(e,t,n,r){var o,i,a,u=e.dom;if(u.isEmpty(r))i=n,a=r,(o=e).dom.$(a).empty(),Yt(o.dom,i,a),o.selection.setCursorLocation(a);else{var s=Pt(t);Yt(u,n,r),e.selection.setRng(Mt(s))}}(e,s,c,a):(n=a).parentNode.firstChild===n?Et(e):function(e,t,n,r){var o=Pt(t);Yt(e.dom,n,r);var i=Mt(o);e.selection.setRng(i)}(e,s,a,c)})),!0;if(!c&&!t&&0===s.startOffset&&0===s.endOffset)return e.undoManager.transact((function(){Bt(e)})),!0}return!1},Jt=function(e,t){return e.selection.isCollapsed()?Gt(i=e,a=t)||function(e,t){var n=e.dom,r=e.selection.getStart(),o=Ze(e,r),i=n.getParent(r,n.isBlock,o);if(i&&n.isEmpty(i)){var a=xt(e.selection.getRng()),u=n.getParent(Xt(e,a,t,o),"LI",o);if(u)return e.undoManager.transact((function(){var r,a,s,c;a=i,s=o,c=(r=n).getParent(a.parentNode,r.isBlock,s),r.remove(a),c&&r.isEmpty(c)&&r.remove(c),Kt(n,u.parentNode),e.selection.select(u,!0),e.selection.collapse(t)})),!0}return!1}(i,a):(r=(n=e).selection.getStart(),o=Ze(n,r),!!(n.dom.getParent(r,"LI,DT,DD",o)||0<Je(n).length)&&(n.undoManager.transact((function(){n.execCommand("Delete"),function(e,t){Me.each(Me.grep(e.select("ol,ul",t)),(function(t){var n,r,o,i;n=e,"LI"===(i=(r=t).parentNode).nodeName&&i.firstChild===r&&((o=i.previousSibling)&&"LI"===o.nodeName?(o.appendChild(r),ze(n,i)&&Qt.remove(i)):Qt.setStyle(i,"listStyleType","none")),$e(i)&&(o=i.previousSibling)&&"LI"===o.nodeName&&o.appendChild(r)}))}(n.dom,n.getBody())})),!0));var n,r,o,i,a},Zt=function(e){var t=e.dom,n=Ge(e);qe(n)&&e.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:t.getAttrib(n,"start")||"1"},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(n){var r=n.getData();e.undoManager.transact((function(){t.setAttrib(Ge(e),"start","1"===r.start?"":r.start)})),n.close()}})},en=function(e,t){return function(){var n=e.dom.getParent(e.selection.getStart(),"UL,OL,DL");return n&&n.nodeName===t}};u.add("lists",(function(e){var t,n,r,o,i,a,s;return 0==!(!/(^|[ ,])rtc([, ]|$)/.test(e.getParam("plugins","","string"))||!u.get("rtc"))&&(function(e){var t,n;e.getParam("lists_indent_on_tab",!0)&&(t=e).on("keydown",(function(e){e.keyCode!==Ce.TAB||Ce.metaKeyPressed(e)||t.undoManager.transact((function(){(e.shiftKey?Et:Dt)(t)&&e.preventDefault()}))})),(n=e).on("keydown",(function(e){e.keyCode===Ce.BACKSPACE?Jt(n,!1)&&e.preventDefault():e.keyCode===Ce.DELETE&&Jt(n,!0)&&e.preventDefault()}))}(e),(t=e).on("BeforeExecCommand",(function(e){var n=e.command.toLowerCase();"indent"===n?Dt(t):"outdent"===n&&Et(t)})),t.addCommand("InsertUnorderedList",(function(e,n){Wt(t,"UL",n)})),t.addCommand("InsertOrderedList",(function(e,n){Wt(t,"OL",n)})),t.addCommand("InsertDefinitionList",(function(e,n){Wt(t,"DL",n)})),t.addCommand("RemoveList",(function(){Bt(t)})),t.addCommand("mceListProps",(function(){Zt(t)})),t.addQueryStateHandler("InsertUnorderedList",en(t,"UL")),t.addQueryStateHandler("InsertOrderedList",en(t,"OL")),t.addQueryStateHandler("InsertDefinitionList",en(t,"DL"))),o=function(e){return function(){return n.execCommand(e)}},r=(n=e).getParam("plugins","","string"),-1===Me.inArray(r.split(/[ ,]/),"advlist")&&(n.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:o("InsertOrderedList"),onSetup:function(e){return Ft(n,"OL",e.setActive)}}),n.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:o("InsertUnorderedList"),onSetup:function(e){return Ft(n,"UL",e.setActive)}})),a={text:"List properties...",icon:"ordered-list",onAction:function(){return Zt(i)},onSetup:function(e){return Ft(i,"OL",(function(t){return e.setDisabled(!t)}))}},(i=e).ui.registry.addMenuItem("listprops",a),i.ui.registry.addContextMenu("lists",{update:function(e){var t=Ge(i,e);return qe(t)?["listprops"]:[]}}),s=e,{backspaceDelete:function(e){Jt(s,e)}}}))}(window);