!function(n){"use strict";var t,e,o,r,i=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=function(n){return function(){return n}},a=u(!1),c=u(!0),l=function(){return s},s=(t=function(n){return n.isNone()},{fold:function(n,t){return n()},is:a,isSome:a,isNone:c,getOr:o=function(n){return n},getOrThunk:e=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:u(null),getOrUndefined:u(void 0),or:o,orThunk:e,map:l,each:function(){},bind:l,exists:a,forall:c,filter:l,equals:t,equals_:t,toArray:function(){return[]},toString:u("none()")}),f=function(n){var t=u(n),e=function(){return r},o=function(t){return t(n)},r={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:c,isNone:a,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return f(t(n))},each:function(t){t(n)},bind:o,exists:o,forall:o,filter:function(t){return t(n)?r:s},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(a,(function(t){return e(n,t)}))}};return r},m={some:f,none:l,from:function(n){return null==n?s:f(n)}},g=function(n,t){return-1!==n.indexOf(t)},d=function(n,t){return g(n.title.toLowerCase(),t)||function(n,t){for(var e=0,o=n.length;e<o;e++)if(t(n[e]))return!0;return!1}(n.keywords,(function(n){return g(n.toLowerCase(),t)}))},y=function(n,t,e){for(var o=[],r=t.toLowerCase(),i=e.fold((function(){return a}),(function(n){return function(t){return n<=t}})),u=0;u<n.length&&(0!==t.length&&!d(n[u],r)||(o.push({value:n[u].char,text:n[u].title,icon:n[u].char}),!i(o.length)));u++);return o},v=function(n){var t=n;return{get:function(){return t},set:function(n){t=n}}},h=function(){return(h=Object.assign||function(n){for(var t,e=1,o=arguments.length;e<o;e++)for(var r in t=arguments[e])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}).apply(this,arguments)},p=Object.prototype.hasOwnProperty,b=(r=function(n,t){return t},function(){for(var n=new Array(arguments.length),t=0;t<n.length;t++)n[t]=arguments[t];if(0===n.length)throw new Error("Can't merge zero objects");for(var e={},o=0;o<n.length;o++){var i=n[o];for(var u in i)p.call(i,u)&&(e[u]=r(e[u],i[u]))}return e}),w=Object.keys,O=Object.hasOwnProperty,C=function(n,t){for(var e=w(n),o=0,r=e.length;o<r;o++){var i=e[o];t(n[i],i)}},k=tinymce.util.Tools.resolve("tinymce.Resource"),j=tinymce.util.Tools.resolve("tinymce.util.Delay"),A=tinymce.util.Tools.resolve("tinymce.util.Promise"),T="All",_={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},D=function(n,t){return e=n,o=t,O.call(e,o)?n[t]:t;var e,o},P=function(n){var t,e=n.getParam("emoticons_append",{},"object");return t=function(n){return h({keywords:[],category:"user"},n)},function(n,t){var e={};return C(n,(function(n,o){var r=t(n,o);e[r.k]=r.v})),e}(e,(function(n,e){return{k:e,v:t(n)}}))},x="pattern";i.add("emoticons",(function(t,e){var o,r,i,u,a,c,l,s=(r=e,(o=t).getParam("emoticons_database_url",r+"/js/emojis"+o.suffix+".js")),f=t.getParam("emoticons_database_id","tinymce.plugins.emoticons","string"),g=function(t,e,o){var r=v(m.none()),i=v(m.none());t.on("init",(function(){k.load(o,e).then((function(n){var e,o,u,a=P(t);e=b(n,a),o={},u=[],C(e,(function(n,t){var e={title:t,keywords:n.keywords,char:n.char,category:D(_,n.category)},r=void 0!==o[e.category]?o[e.category]:[];o[e.category]=r.concat([e]),u.push(e)})),r.set(m.some(o)),i.set(m.some(u))}),(function(t){n.console.log("Failed to load emoticons: "+t),r.set(m.some({})),i.set(m.some([]))}))}));var u=function(){return i.get().getOr([])},a=function(){return r.get().isSome()&&i.get().isSome()};return{listCategories:function(){return[T].concat(w(r.get().getOr({})))},hasLoaded:a,waitForLoad:function(){return a()?A.resolve(!0):new A((function(t,o){var r=15,i=j.setInterval((function(){a()?(j.clearInterval(i),t(!0)):--r<0&&(n.console.log("Could not load emojis from url: "+e),j.clearInterval(i),o(!1))}),100)}))},listAll:u,listCategory:function(n){return n===T?u():r.get().bind((function(t){return m.from(t[n])})).getOr([])}}}(t,s,f);u=g,a=function(){return function(t,e){var o,r,i={pattern:"",results:y(e.listAll(),"",m.some(300))},u=v(T),a=(o=function(n){var t,o,r,i,a;o=(t=n).getData(),r=u.get(),i=e.listCategory(r),a=y(i,o[x],r===T?m.some(300):m.none()),t.setData({results:a})},r=null,{cancel:function(){null!==r&&(n.clearTimeout(r),r=null)},throttle:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];null!==r&&n.clearTimeout(r),r=n.setTimeout((function(){o.apply(null,t),r=null}),200)}}),c={label:"Search",type:"input",name:x},l={type:"collection",name:"results"},s=function(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(n,t){for(var e=n.length,o=new Array(e),r=0;r<e;r++){var i=n[r];o[r]=t(i)}return o}(e.listCategories(),(function(n){return{title:n,name:n,items:[c,l]}}))},initialData:i,onTabChange:function(n,t){u.set(t.newTabName),a.throttle(n)},onChange:a.throttle,onAction:function(n,e){var o,r;"results"===e.name&&(o=t,r=e.value,o.insertContent(r),n.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},f=t.windowManager.open(s());f.focus(x),e.hasLoaded()||(f.block("Loading emoticons..."),e.waitForLoad().then((function(){f.redial(s()),a.throttle(f),f.focus(x),f.unblock()})).catch((function(n){f.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),f.focus(x),f.unblock()})))}(i,u)},(i=t).ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:a}),i.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:a}),l=g,(c=t).ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(n,t){return l.waitForLoad().then((function(){var e=l.listAll();return y(e,n,m.some(t))}))},onAction:function(n,t,e){c.selection.setRng(t),c.insertContent(e),n.hide()}})}))}(window);